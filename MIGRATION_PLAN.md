# План миграции Django-шаблонов на React

## Анализ шаблонов (от простых к сложным)

### 1. ✅ payment/completed.html — ОЧЕНЬ ПРОСТОЙ
**Сложность:** ⭐ (1/5)  
**View:** `payment.views.payment_completed`  
**URL:** `/payment/completed/`  
**Контекст:** Нет данных  
**API Endpoint:** Не требуется (статичная страница)  
**Зависимости:** Только base.html  
**Приоритет:** Высокий (первый кандидат)

---

### 2. ✅ payment/canceled.html — ОЧЕНЬ ПРОСТОЙ
**Сложность:** ⭐ (1/5)  
**View:** `payment.views.payment_canceled`  
**URL:** `/payment/canceled/`  
**Контекст:** Нет данных  
**API Endpoint:** Не требуется (статичная страница)  
**Зависимости:** Только base.html  
**Приоритет:** Высокий (первый кандидат)

---

### 3. ✅ orders/order/created.html — ОЧЕНЬ ПРОСТОЙ
**Сложность:** ⭐ (1/5)  
**View:** Не используется напрямую (редирект после создания заказа)  
**URL:** Нет прямого URL  
**Контекст:** Нет данных  
**API Endpoint:** Не требуется (статичная страница)  
**Зависимости:** Только base.html  
**Приоритет:** Высокий (первый кандидат)

---

### 4. main/index/index.html — ПРОСТОЙ
**Сложность:** ⭐⭐ (2/5)  
**View:** `main.views.popular_list`  
**URL:** `/` (root)  
**Контекст:** 
- `products` — QuerySet из 3 доступных продуктов

**API Endpoints:**
- ✅ `GET /api/v1/products/available/` — доступные продукты
- ✅ `GET /api/v1/products/?available=true` — с фильтром

**Зависимости:** 
- base.html
- Статические файлы (изображения)

**Особенности:**
- Цикл по продуктам
- Условная логика для скидок
- Изображения продуктов

**Приоритет:** Средний (после статичных страниц)

---

### 5. main/product/list.html — СРЕДНИЙ
**Сложность:** ⭐⭐⭐ (3/5)  
**View:** `main.views.product_list`  
**URL:** `/shop/` и `/shop/category/<slug>/`  
**Контекст:**
- `category` — текущая категория (может быть None)
- `categories` — все категории
- `products` — пагинированный список продуктов
- `slug_url` — slug категории

**API Endpoints:**
- ✅ `GET /api/v1/categories/` — все категории
- ✅ `GET /api/v1/products/` — все продукты (с пагинацией)
- ✅ `GET /api/v1/products/?available=true` — фильтр по доступности
- ⚠️ Нужна фильтрация по категории через query params

**Зависимости:**
- base.html
- Пагинация Django

**Особенности:**
- Фильтрация по категориям
- Пагинация (10 элементов на страницу)
- Боковая панель с категориями
- Условная логика для активной категории

**Приоритет:** Средний

---

### 6. main/product/detail.html — СРЕДНИЙ
**Сложность:** ⭐⭐⭐ (3/5)  
**View:** `main.views.product_detail`  
**URL:** `/shop/<slug>/`  
**Контекст:**
- `product` — объект Product
- `cart_product_form` — форма CartAddProductForm

**API Endpoints:**
- ✅ `GET /api/v1/products/{slug}/` — детали продукта
- ⚠️ Нет API для добавления в корзину (корзина работает через сессии)

**Зависимости:**
- base.html
- Форма добавления в корзину (POST на `/cart/add/<product_id>/`)

**Особенности:**
- Отображение деталей продукта
- Форма добавления в корзину (POST-запрос)
- Условная логика для скидок
- Изображение продукта

**Приоритет:** Средний (требует API для корзины)

---

### 7. cart/detail.html — СРЕДНИЙ
**Сложность:** ⭐⭐⭐ (3/5)  
**View:** `cart.views.cart_detail`  
**URL:** `/cart/`  
**Контекст:**
- `cart` — объект Cart (сессионная корзина)

**API Endpoints:**
- ⚠️ Нет API для корзины (работает через Django сессии)
- ⚠️ Нужно создать API для корзины или переделать на клиентскую корзину

**Зависимости:**
- base.html
- Формы удаления товаров (POST на `/cart/remove/<product_id>/`)

**Особенности:**
- Отображение товаров в корзине
- Формы удаления товаров
- Подсчет общей суммы
- Кнопка перехода к оформлению заказа

**Приоритет:** Низкий (требует рефакторинга корзины)

---

### 8. users/login.html — СРЕДНИЙ
**Сложность:** ⭐⭐⭐ (3/5)  
**View:** `users.views.login`  
**URL:** `/user/login/`  
**Контекст:**
- `form` — UserLoginForm

**API Endpoints:**
- ✅ `POST /api/v1/auth-token/` — получение токена аутентификации

**Зависимости:**
- base.html
- Обработка редиректа после логина

**Особенности:**
- Форма логина
- Обработка ошибок
- Редирект на следующую страницу (next parameter)

**Приоритет:** Средний

---

### 9. users/registration.html — СРЕДНИЙ
**Сложность:** ⭐⭐⭐ (3/5)  
**View:** `users.views.registration`  
**URL:** `/user/registration/`  
**Контекст:**
- `form` — UserRegistrationForm

**API Endpoints:**
- ✅ `POST /api/v1/users/` — регистрация пользователя

**Зависимости:**
- base.html
- Валидация формы на клиенте

**Особенности:**
- Форма регистрации (много полей)
- Валидация паролей
- Автоматический логин после регистрации

**Приоритет:** Средний

---

### 10. orders/order/create.html — СЛОЖНЫЙ
**Сложность:** ⭐⭐⭐⭐ (4/5)  
**View:** `orders.views.order_create`  
**URL:** `/orders/create/`  
**Контекст:**
- `cart` — объект Cart
- `form` — OrderCreateForm

**API Endpoints:**
- ✅ `POST /api/v1/orders/` — создание заказа
- ⚠️ Нет API для корзины (зависит от сессионной корзины)

**Зависимости:**
- base.html
- Корзина (сессионная)
- Редирект на оплату после создания

**Особенности:**
- Форма создания заказа (много полей)
- Отображение товаров из корзины
- Подсчет общей суммы
- Создание OrderItem для каждого товара

**Приоритет:** Низкий (требует рефакторинга корзины)

---

### 11. payment/process.html — СЛОЖНЫЙ
**Сложность:** ⭐⭐⭐⭐ (4/5)  
**View:** `payment.views.payment_process`  
**URL:** `/payment/process/`  
**Контекст:**
- `order` — объект Order
- `order_id` — из сессии
- Stripe данные

**API Endpoints:**
- ✅ `GET /api/v1/orders/{id}/` — получение заказа
- ⚠️ Нет API для создания Stripe сессии

**Зависимости:**
- base.html
- Stripe интеграция
- Сессия Django (order_id)

**Особенности:**
- Отображение заказа
- Интеграция со Stripe
- Редирект на Stripe Checkout

**Приоритет:** Низкий (требует API для Stripe)

---

### 12. users/profile.html — ОЧЕНЬ СЛОЖНЫЙ
**Сложность:** ⭐⭐⭐⭐⭐ (5/5)  
**View:** `users.views.profile`  
**URL:** `/user/profile/`  
**Контекст:**
- `form` — ProfileForm (для редактирования профиля)
- `orders` — QuerySet заказов пользователя с prefetch_related

**API Endpoints:**
- ✅ `GET /api/v1/users/me/` — текущий пользователь
- ✅ `PUT /api/v1/users/{id}/` — обновление профиля
- ✅ `GET /api/v1/orders/` — заказы пользователя (уже фильтруются по пользователю)

**Зависимости:**
- base.html
- Загрузка файлов (изображение профиля)
- Отображение истории заказов

**Особенности:**
- Форма редактирования профиля
- Загрузка изображения
- Отображение истории заказов с деталями
- Сложная структура данных (заказы с товарами)

**Приоритет:** Низкий (самый сложный)

---

### 13. main/base.html — БАЗОВЫЙ ШАБЛОН
**Сложность:** ⭐⭐⭐ (3/5)  
**View:** Используется везде через `{% extends %}`  
**URL:** Нет прямого URL  
**Контекст:**
- `user` — текущий пользователь (из context processor)
- `cart` — корзина (из context processor)

**API Endpoints:**
- ✅ `GET /api/v1/users/me/` — информация о пользователе
- ⚠️ Нет API для корзины

**Зависимости:**
- Статические файлы (Bootstrap, CSS, изображения)
- Context processors

**Особенности:**
- Навигация
- Отображение количества товаров в корзине
- Условная логика для авторизованных пользователей
- Базовые стили и скрипты

**Приоритет:** Высокий (нужен для всех страниц, но можно сделать React Layout компонент)

---

## Рекомендуемый порядок миграции

### Фаза 1: Статичные страницы (самые простые)
1. ✅ **payment/completed.html** — "Payment was successful"
2. ✅ **payment/canceled.html** — "Payment was canceled"  
3. ✅ **orders/order/created.html** — "Your order was created"

**Преимущества:**
- Нет зависимости от данных
- Нет форм
- Быстрая реализация
- Можно сразу протестировать роутинг

---

### Фаза 2: Простые страницы с данными
4. **main/index/index.html** — Главная страница с популярными товарами
   - Использует `GET /api/v1/products/available/`
   - Простой список без пагинации

---

### Фаза 3: Страницы со списками
5. **main/product/list.html** — Список продуктов с фильтрацией
   - Использует `GET /api/v1/categories/` и `GET /api/v1/products/`
   - Требует пагинацию на клиенте
   - Фильтрация по категориям

---

### Фаза 4: Страницы с деталями
6. **main/product/detail.html** — Детали продукта
   - Использует `GET /api/v1/products/{slug}/`
   - ⚠️ Требует API для корзины или клиентскую корзину

---

### Фаза 5: Аутентификация
7. **users/login.html** — Вход
8. **users/registration.html** — Регистрация

---

### Фаза 6: Сложные страницы (требуют рефакторинга)
9. **cart/detail.html** — Корзина (требует API для корзины)
10. **orders/order/create.html** — Создание заказа
11. **payment/process.html** — Оплата
12. **users/profile.html** — Профиль

---

## Статус API Endpoints

### ✅ Готовые эндпоинты:
- `GET /api/v1/categories/` — список категорий
- `GET /api/v1/products/` — список продуктов (с пагинацией)
- `GET /api/v1/products/{slug}/` — детали продукта
- `GET /api/v1/products/available/` — доступные продукты
- `GET /api/v1/users/me/` — текущий пользователь
- `POST /api/v1/users/` — регистрация
- `POST /api/v1/auth-token/` — получение токена
- `GET /api/v1/orders/` — список заказов
- `POST /api/v1/orders/` — создание заказа

### ⚠️ Требуют создания:
- API для корзины (или переделать на клиентскую корзину)
- API для создания Stripe сессии
- Фильтрация продуктов по категории через query params

---

## Следующие шаги

1. **Начать с миграции статичных страниц** (payment/completed, payment/canceled, orders/created)
2. **Создать React Layout компонент** (аналог base.html)
3. **Мигрировать главную страницу** (index.html)
4. **Постепенно переходить к более сложным страницам**

